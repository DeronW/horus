!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("js-base64"),require("js-cookie"),require("ua-parser-js")):"function"==typeof define&&define.amd?define(["js-base64","js-cookie","ua-parser-js"],n):"object"==typeof exports?exports.Horus=n(require("js-base64"),require("js-cookie"),require("ua-parser-js")):e.Horus=n(e.JSBase64,e.JSCookie,e.UAParser)}(window,function(__WEBPACK_EXTERNAL_MODULE_js_base64__,__WEBPACK_EXTERNAL_MODULE_js_cookie__,__WEBPACK_EXTERNAL_MODULE_ua_parser_js__){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s="./src/index.js")}({"./src/cookie.js":
/*!***********************!*\
  !*** ./src/cookie.js ***!
  \***********************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\n\nvar _jsCookie = __webpack_require__(/*! js-cookie */ "js-cookie");\n\nvar _jsCookie2 = _interopRequireDefault(_jsCookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar USER_ID = "__HORUS_USER_ID";\n\nfunction geUserID() {\n    var uid = _jsCookie2.default.get(USER_ID);\n\n    if (!uid) {\n        uid = "anonym." + (new Date().getTime() / 1000 + Math.random());\n        var host = location.host.split(".");\n        var domain = ["*"];\n        domain[2] = host.pop();\n        domain[1] = host.pop();\n\n        _jsCookie2.default.set(USER_ID, uid, {\n            expires: 365 * 7\n        });\n        _jsCookie2.default.set(USER_ID, uid, {\n            expires: 365 * 7,\n            domain: domain.join(".")\n        });\n    }\n    return uid;\n}\n\nfunction getAccountID() {\n    return _jsCookie2.default.get("account_id");\n}\n\nexports.default = {\n    geUserID: geUserID,\n    getAccountID: getAccountID\n};\n\n//# sourceURL=webpack://Horus/./src/cookie.js?')},"./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\n\nvar _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\n__webpack_require__(/*! ./version.js */ "./src/version.js");\n\nvar _schema = __webpack_require__(/*! ./schema.js */ "./src/schema.js");\n\nvar _schema2 = _interopRequireDefault(_schema);\n\nvar _serialize = __webpack_require__(/*! ./serialize.js */ "./src/serialize.js");\n\nvar _serialize2 = _interopRequireDefault(_serialize);\n\nvar _request = __webpack_require__(/*! ./request.js */ "./src/request.js");\n\nvar _request2 = _interopRequireDefault(_request);\n\nvar _listeners = __webpack_require__(/*! ./listeners */ "./src/listeners/index.js");\n\nvar _listeners2 = _interopRequireDefault(_listeners);\n\nvar _throttle = __webpack_require__(/*! ./throttle.js */ "./src/throttle.js");\n\nvar _throttle2 = _interopRequireDefault(_throttle);\n\nvar _cookie = __webpack_require__(/*! ./cookie.js */ "./src/cookie.js");\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }\n\nfunction log() {\n    var _window$console;\n\n    (_window$console = window["console"]).log.apply(_window$console, arguments);\n}\n\nvar Horus = function () {\n    function Horus(options) {\n        _classCallCheck(this, Horus);\n\n        this._done = false;\n        this.opt = Object.assign({\n            url: "",\n            project: "Empty",\n            account_id: _cookie2.default.getAccountID(),\n            debug: false,\n            request_type: "auto",\n            listen: {\n                click: true,\n                hover: true,\n                history: false,\n                scroll: false\n            }\n        }, options);\n\n        this.listners = {\n            click: [_listeners2.default.Click],\n            hover: [_listeners2.default.Hover],\n            history: [_listeners2.default.History],\n            scroll: []\n            // then, should call this.start()\n        };\n    }\n\n    _createClass(Horus, [{\n        key: "_setOption",\n        value: function _setOption(k, v) {\n            if (this.opt.hasOwnProperty(k)) {\n                this.opt[k] = v;\n            } else {\n                log("Horus config: " + k + " has been ignored");\n            }\n        }\n    }, {\n        key: "setConfig",\n        value: function setConfig(key, value) {\n            var options = (typeof key === "undefined" ? "undefined" : _typeof(key)) === "object" ? key : _defineProperty({}, key, value);\n\n            for (var k in options) {\n                this._setOption(k, options[k]);\n            }\n        }\n    }, {\n        key: "ready",\n        value: function ready(cb) {\n            if (document.readyState === "complete") {\n                cb();\n            } else {\n                document.addEventListener("DOMContentLoaded", function () {\n                    // document.removeEventListener("DOMContentLoaded", arguments.callee, false);\n                    cb();\n                }, false);\n            }\n        }\n    }, {\n        key: "observe",\n        value: function observe() {\n            this.observer = new MutationObserver(function (mutations) {\n                mutations.forEach(function (mutation) {\n                    log(mutation.target);\n                    log(mutation.addedNodes);\n                    log(mutation.removedNodes);\n                });\n            });\n            this.observer.observe(document.body, {\n                // 监听子节点\n                childList: true,\n                // 监听 href 属性\n                attributes: true,\n                // 监听整棵树\n                subtree: true\n            });\n        }\n    }, {\n        key: "addListener",\n        value: function addListener(name, fn) {\n            if (!this.listners[name]) throw Error("Horus: 没有这种监听类型");\n\n            this.listners[name].push(fn);\n        }\n    }, {\n        key: "dispatch",\n        value: function dispatch(name, event) {\n            var _this = this;\n\n            (this.listners[name] || []).forEach(function (fn) {\n                if (typeof fn === "function") {\n                    var data = fn(event);\n                    data && _this._report(name, data);\n                }\n            });\n        }\n\n        // 开始监听\n\n    }, {\n        key: "start",\n        value: function start() {\n            var _this2 = this;\n\n            if (this._done) {\n                throw Error("Horus 不能重复监听全局事件");\n            } else {\n                this._done = true;\n            }\n\n            // 点击事件\n            if (this.opt.listen.click) {\n                document.addEventListener("click", function (e) {\n                    return _this2.dispatch("click", e);\n                });\n            }\n\n            // hover 事件\n            if (this.opt.listen.hover) {\n                document.addEventListener("mouseover", (0, _throttle2.default)(function (e) {\n                    this.dispatch("hover", e);\n                }.bind(this), 300));\n            }\n\n            return this;\n        }\n    }, {\n        key: "decorator",\n        value: function decorator(event_type, data) {\n            var custom = data || {};\n\n            if ((typeof custom === "undefined" ? "undefined" : _typeof(custom)) != \'object\') custom = { msg: String(data) };\n\n            var schema = {\n                time: new Date().getTime(),\n                project: this.opt.project,\n                event_id: new Date().getTime() + "-" + Math.random().toString().substr(2),\n                event: event_type,\n                properties: Object.assign({\n                    cookie: "",\n                    account_id: _cookie2.default.getAccountID(),\n                    user_id: _cookie2.default.geUserID()\n                }, _schema2.default.Properties()),\n                custom: custom\n                // 旧字段, 需要兼容\n            };if (schema.custom.mark) {\n                var t = schema.custom.mark.split(\':\');\n                if (t[0]) schema.event_type = t[0];\n            }\n\n            if (this.opt.debug) {\n                log("Horus reporting: ", schema);\n                log(schema.custom && schema.custom.xpath);\n            }\n            return schema;\n        }\n    }, {\n        key: "occur",\n        value: function occur(event_type, data) {\n            this._report(event_type, data);\n        }\n    }, {\n        key: "_report",\n        value: function _report(event_type, data) {\n            var url = this.opt.url;\n            if (url.indexOf("?") < 0) url += "?";\n            url += "&data=" + (0, _serialize2.default)(this.decorator(event_type, data));\n            url += "&_=" + new Date().getTime();\n            (0, _request2.default)(this.request_type, url);\n        }\n    }]);\n\n    return Horus;\n}();\n\nexports.default = Horus;\n\n//# sourceURL=webpack://Horus/./src/index.js?')},"./src/listeners/click.js":
/*!********************************!*\
  !*** ./src/listeners/click.js ***!
  \********************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _xpath = __webpack_require__(/*! ../xpath.js */ \"./src/xpath.js\");\n\nvar _xpath2 = _interopRequireDefault(_xpath);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction Click(event) {\n    var target = event.target;\n\n    var info = pick_info(event.target);\n\n    return {\n        mark: info.mark,\n        desc: info.text,\n        xpath: (0, _xpath2.default)(event.target),\n        pageX: event.pageX,\n        pageY: event.pageY\n    };\n}\n\nfunction pick_info(element) {\n    if (element == document.body) {\n        return {\n            mark: 'click:body',\n            text: 'pointless click'\n        };\n    }\n\n    var mark = void 0,\n        text = element.innerText.substr(0, 20);\n    var testament = findAncestorMark(element);\n    if (testament) {\n        var r = testament.split(':');\n        mark = r[0];\n        if (r[1]) text = r[1];\n    }\n    return {\n        mark: 'click' + (mark ? ':' + mark : ''),\n        text: text\n    };\n}\n\nfunction findAncestorMark(src, cnd) {\n    while (src && src != document) {\n        var mark = src.getAttribute('ho-click');\n        if (mark) return mark;\n        src = src.parentNode;\n    }\n}\n\nexports.default = Click;\n\n//# sourceURL=webpack://Horus/./src/listeners/click.js?")},"./src/listeners/hover.js":
/*!********************************!*\
  !*** ./src/listeners/hover.js ***!
  \********************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _xpath = __webpack_require__(/*! ../xpath.js */ \"./src/xpath.js\");\n\nvar _xpath2 = _interopRequireDefault(_xpath);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction Hover(event) {\n    var go = false,\n        target = event.target;\n    while (target && target != document) {\n        if (target.getAttribute('data-horus')) {\n            go = true;\n            break;\n        }\n        target = target.parentNode;\n    }\n    if (!go) return;\n\n    return {\n        event: 'hover',\n        title: get_title(event.target),\n        desc: get_desc(event.target),\n        xpath: (0, _xpath2.default)(event.target)\n    };\n}\n\nfunction get_title(element) {\n    return element.innerText;\n}\n\nfunction get_desc(element) {\n    return 'TODO';\n}\n\nexports.default = Hover;\n\n//# sourceURL=webpack://Horus/./src/listeners/hover.js?")},"./src/listeners/index.js":
/*!********************************!*\
  !*** ./src/listeners/index.js ***!
  \********************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\n\nvar _click = __webpack_require__(/*! ./click.js */ "./src/listeners/click.js");\n\nvar _click2 = _interopRequireDefault(_click);\n\nvar _hover = __webpack_require__(/*! ./hover.js */ "./src/listeners/hover.js");\n\nvar _hover2 = _interopRequireDefault(_hover);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// import History from \'./history.js\'\n\nexports.default = {\n    Click: _click2.default,\n    Hover: _hover2.default\n};\n// import Link from \'./link.js\'\n\n//# sourceURL=webpack://Horus/./src/listeners/index.js?')},"./src/request.js":
/*!************************!*\
  !*** ./src/request.js ***!
  \************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\nfunction AjaxRequest(url) {\n    var xhr = new XMLHttpRequest();\n    xhr.open("GET", url, true);\n\n    return new Promise(function (resolve, reject) {\n        xhr.onload = function () {\n            xhr.status < 300 ? resolve() : reject();\n        };\n        xhr.send();\n    });\n}\n\nfunction ImageRequest(url) {\n    var img = document.createElement("img");\n    img.style.display = "none";\n\n    return new Promise(function (resolve) {\n        img.onload = function () {\n            document.body.removeChild(img);\n            resolve();\n        };\n        img.src = url;\n        document.body.appendChild(img);\n    });\n}\n\nfunction MakeRequest(request_type, url) {\n    return request_type == "image" ? ImageRequest(url) : AjaxRequest(url);\n}\n\nexports.default = MakeRequest;\nexports.ImageRequest = ImageRequest;\nexports.AjaxRequest = AjaxRequest;\n\n//# sourceURL=webpack://Horus/./src/request.js?')},"./src/schema.js":
/*!***********************!*\
  !*** ./src/schema.js ***!
  \***********************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\n\nvar _uaParserJs = __webpack_require__(/*! ua-parser-js */ "ua-parser-js");\n\nvar _uaParserJs2 = _interopRequireDefault(_uaParserJs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction Properties(ua) {\n    var UA = new _uaParserJs2.default(ua || navigator.userAgent).getResult();\n\n    return {\n        user_brand: UA.device.vendor,\n        user_explorer: UA.browser.name + "/" + UA.browser.version,\n        user_model: UA.device.model,\n        user_os: UA.os.name + "/" + UA.os.version\n    };\n}\n\nexports.default = {\n    Properties: Properties\n};\n\n//# sourceURL=webpack://Horus/./src/schema.js?')},"./src/serialize.js":
/*!**************************!*\
  !*** ./src/serialize.js ***!
  \**************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\n\nvar _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };\n\nvar _jsBase = __webpack_require__(/*! js-base64 */ "js-base64");\n\nfunction Serialize(schema) {\n    if ((typeof schema === "undefined" ? "undefined" : _typeof(schema)) == "object") schema = JSON.stringify(schema);\n    return _jsBase.Base64.encode(schema);\n}\n\nexports.default = Serialize;\n\n//# sourceURL=webpack://Horus/./src/serialize.js?')},"./src/throttle.js":
/*!*************************!*\
  !*** ./src/throttle.js ***!
  \*************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\nfunction Debounce(fn) {\n    var delay = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1000;\n\n    var timer = void 0;\n\n    return function (event) {\n        clearTimeout(timer);\n        timer = setTimeout(function () {\n            fn(event);\n        }, delay);\n    };\n}\n\nfunction Throttle(fn) {\n    var delay = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1000;\n\n    var last = 0;\n    return function (event) {\n        var now = new Date().getTime();\n        if (now - last > delay) {\n            fn(event);\n            last = now;\n        }\n    };\n}\n\nexports.default = Throttle;\n\n//# sourceURL=webpack://Horus/./src/throttle.js?')},"./src/version.js":
/*!************************!*\
  !*** ./src/version.js ***!
  \************************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval("/*!\n * Horus version x.x.x\n * @license  BSD\n */\n\n\n//# sourceURL=webpack://Horus/./src/version.js?")},"./src/xpath.js":
/*!**********************!*\
  !*** ./src/xpath.js ***!
  \**********************/
/*! no static exports found */function(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n    value: true\n});\nfunction getXPath(element) {\n\n    // 特殊处理返回\n    if (element.id !== "") {\n        return "//*[@id=\\"" + element.id + "\\"]";\n    } else if (element === document.body) {\n        return "/html/body";\n    }\n\n    var index = 1;\n    var str = "";\n\n    Array.prototype.slice.call(element.parentNode.childNodes).forEach(function (sibling) {\n        if (sibling === element) {\n            str = getXPath(element.parentNode);\n\n            // 需要连接符\n            if (str) {\n                str += "/";\n            }\n\n            str += element.tagName.toLowerCase() + "[" + index + "]";\n        } else if (sibling.nodeType === 1 && sibling.tagName === element.tagName) {\n            index += 1;\n        }\n    });\n\n    // 如果同级节点只有一个标签, 则去掉索引\n    if (index === 1 && str) {\n        str = str.substr(0, str.length - 3);\n    }\n\n    return str;\n}\n\nexports.default = getXPath;\n\n//# sourceURL=webpack://Horus/./src/xpath.js?')},"js-base64":
/*!*****************************************************************************************************!*\
  !*** external {"commonjs":"js-base64","commonjs2":"js-base64","amd":"js-base64","root":"JSBase64"} ***!
  \*****************************************************************************************************/
/*! no static exports found */function(module,exports){eval("module.exports = __WEBPACK_EXTERNAL_MODULE_js_base64__;\n\n//# sourceURL=webpack://Horus/external_%7B%22commonjs%22:%22js-base64%22,%22commonjs2%22:%22js-base64%22,%22amd%22:%22js-base64%22,%22root%22:%22JSBase64%22%7D?")},"js-cookie":
/*!*****************************************************************************************************!*\
  !*** external {"commonjs":"js-cookie","commonjs2":"js-cookie","amd":"js-cookie","root":"JSCookie"} ***!
  \*****************************************************************************************************/
/*! no static exports found */function(module,exports){eval("module.exports = __WEBPACK_EXTERNAL_MODULE_js_cookie__;\n\n//# sourceURL=webpack://Horus/external_%7B%22commonjs%22:%22js-cookie%22,%22commonjs2%22:%22js-cookie%22,%22amd%22:%22js-cookie%22,%22root%22:%22JSCookie%22%7D?")},"ua-parser-js":
/*!**************************************************************************************************************!*\
  !*** external {"commonjs":"ua-parser-js","commonjs2":"ua-parser-js","amd":"ua-parser-js","root":"UAParser"} ***!
  \**************************************************************************************************************/
/*! no static exports found */function(module,exports){eval("module.exports = __WEBPACK_EXTERNAL_MODULE_ua_parser_js__;\n\n//# sourceURL=webpack://Horus/external_%7B%22commonjs%22:%22ua-parser-js%22,%22commonjs2%22:%22ua-parser-js%22,%22amd%22:%22ua-parser-js%22,%22root%22:%22UAParser%22%7D?")}})});